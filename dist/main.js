!function(e,a,n){"use strict";function t(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var a=new RegExp("[\\?&]"+e+"=([^&#]*)"),n=a.exec(location.search);return null===n?"":decodeURIComponent(n[1].replace(/\+/g," "))}function o(e){var a=45.42235930900181,n=20.36224326171873,t=44.93836277320517,o=18.98895224609373;if(isNaN(T)===!1&&isNaN(O)===!1){var l=parseFloat(T),i=parseFloat(O);if(l<a&&l>t&&i<n&&i>o){if(I=!0,"center"==e)return{lat:l,lng:i};if("zoom"==e)return new google.maps.Marker({position:new google.maps.LatLng(l,i),map:v,zIndex:0,icon:new google.maps.MarkerImage("http://fruskac.net/sites/all/themes/fruskac/css/img/icons/current-location.png",new google.maps.Size(74,74),new google.maps.Point(0,0),new google.maps.Point(38,54))}),13}}return"center"==e?{lat:45.167031,lng:19.69677}:"zoom"==e?12:void 0}function l(){v=new google.maps.Map(document.getElementById("map"),{mapTypeId:google.maps.MapTypeId.TERRAIN,mapTypeControl:!1,zoomControlOptions:{position:google.maps.ControlPosition.LEFT_BOTTOM},streetViewControlOptions:{position:google.maps.ControlPosition.LEFT_BOTTOM}}),v.setCenter(o("center")),v.setZoom(o("zoom")),google.maps.event.addListenerOnce(v,"idle",function(){a(".satellite-view").show()}),google.maps.event.addListener(v,"center_changed",function(){console.log("center changed")}),google.maps.event.addListener(v,"bounds_changed",function(){console.log("bounds changed")});var e={north:45.166508,south:45.136001,east:19.767672,west:19.681498},n={opacity:.8,clickable:!1},l=new google.maps.GroundOverlay("http://fruskac.net/sites/all/themes/fruskac/css/img/fruskac-logo-map.png",e,n);l.setMap(v),w=new MarkerClusterer(v,[],{gridSize:50,imagePath:"https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m"}),C=a(".clustering-checkbox :checkbox").prop("checked"),a(".layer-toggle :checkbox").trigger("init");var i=t("tracks"),s=t("kmls");i&&m(i,"tracks"),s&&m(s,"kmls")}function i(e){var t;return a.ajax({type:"GET",url:e.url,dataType:"xml",async:!1}).done(function(o){var l,i=[],s=new google.maps.LatLngBounds;a(o).find("trkpt").each(function(e,n){var t=Number(a(this).attr("lat")),o=Number(a(this).attr("lon")),l=new google.maps.LatLng(t,o);i.push(l),s.extend(l)});var r={path:i,strokeColor:e.data.stroke_color,strokeOpacity:.7,strokeWeight:4,data:{type:"track"}};e.data.fill_color?(r.fillColor=e.data.fill_color,r.fillOpacity=.35,l=new google.maps.Polygon(r)):l=new google.maps.Polyline(r);var c="<h2>"+e.url+"</h2>";l.addListener("click",function(e){x!==n&&x.close(),x=new google.maps.InfoWindow({content:c}),x.setContent(c),x.setPosition(e.latLng),x.open(v)}),t=l}),t}function s(e){var a=new google.maps.KmlLayer(e.url,{suppressInfoWindows:!0,preserveViewport:I,data:{type:"kml"}}),t="<h2>"+e.url+"</h2>";return a.addListener("click",function(e){x!==n&&x.close(),x=new google.maps.InfoWindow({content:t}),x.setContent(t),x.setPosition(e.latLng),x.open(v)}),a}function r(e){var t=[];a.each(e,function(e,a){var o=a.tag,l=a.data.title,i=new google.maps.MarkerImage(a.options.icon_data.url,new google.maps.Size(a.options.icon_data.width,a.options.icon_data.height),new google.maps.Point(a.options.icon_data.x,a.options.icon_data.y)),s=new google.maps.Marker({position:new google.maps.LatLng(a.lat,a.lng),icon:i,title:l,data:{type:"marker",tag:o}}),r="<h2>"+l+'</h2><a href="'+a.data.link+'" target="_blank"><img src="'+a.data.image+'"></a><p>'+a.data.description+"</p>";s.addListener("click",function(){x!==n&&x.close(),x=new google.maps.InfoWindow({content:r}),x.open(v,s)}),M.indexOf(o)!==-1?s.setVisible(!0):s.setVisible(!1),L.push(s),t.push(s)}),g(t)}function c(e){var n=[];a.each(e,function(e,a){var t=i(a);if(t){var o=a.tag;t.data.tag=o,M.indexOf(o)!==-1?t.setVisible(!0):t.setVisible(!1),L.push(t),n.push(t)}}),g(n)}function p(e){a.each(e,function(e,a){var n=s(a),t=a.tag;n.data.tag=t,M.indexOf(t)!==-1?n.setMap(v):n.setMap(null),L.push(n)})}function d(e,n){var t="data/"+e+".json";a.ajax({url:t,type:"GET",dataType:"json",async:!1}).done(function(e){switch(n){case"marker":r(e);break;case"track":c(e);break;case"kml":p(e);break;default:alert("Unknown layer type")}})}function g(e){a.each(e,function(e,a){a.setMap(v),C&&"marker"==a.data.type&&a.visible===!0&&w.addMarker(a)})}function u(e){a.each(e,function(e,a){a.setMap(null),C&&"marker"==a.data.type&&w.removeMarker(a)})}function h(){var e=[],n=[];w.clearMarkers(),a.each(L,function(a,t){M.indexOf(t.data.tag)!==-1?("kml"!=t.data.type&&t.setVisible(!0),e.push(t)):("kml"!=t.data.type&&t.setVisible(!1),n.push(t))}),u(n),g(e)}function m(e,n){var t="data/"+e+".json";a.ajax({url:t,type:"GET",dataType:"json",async:!1}).done(function(e){switch(n){case"tracks":f(e);break;case"kmls":k(e)}})}function f(e){a.each(e,function(e,a){var n=i(a);n&&(n.setMap(v),n.setVisible(!0))})}function k(e){a.each(e,function(e,a){var n=s(a);n&&n.setMap(v)})}function y(){var e=a(window).height(),n=a(".panel").height(),t=a(".panel-header").height(),o=a(".simplebar-content").height();e<n&&0==a(".panel-layers").hasClass("simplebar")?(a(".panel-layers").height(e-t),a(".panel-layers").addClass("simplebar"),a(".panel-layers").simplebar()):e<o+t&&a(".panel-layers").hasClass("simplebar")?(a(".panel-layers").height(e-t),a(".panel-layers").simplebar("recalculate")):(a(".panel-layers").height(o),a(".panel-layers").simplebar("recalculate"))}function b(){var e=a(window).width();e<900&&a(".panel").addClass("collapsed")}var v,w,x,C,M=[],L=[],T=Number(t("lat")),O=Number(t("lng")),I=!1;google.maps.event.addDomListener(window,"load",l),b(),y(),a(function(){BigScreen.enabled&&1==t("embed")&&(a(".fullscreen-btn").show(),a(".panel-header").hide())}),a(window).on("resize",function(){y()}),a(document).on("click",".menu-btn",function(e){a(".panel").toggleClass("collapsed"),y()}),a(document).on("click",".expand-collapse",function(e){a(this).toggleClass("expanded collapsed"),y()}),a(document).on("init change",".layer-toggle :checkbox",function(e){var t=a(this),o=t.parent(),l=o.data("layer"),i=o.data("type"),s=t.prop("checked"),r=t.parents(".layer"),c="init"===e.type;c===!1&&(r.children(".expand-collapse").toggleClass("expanded collapsed"),y());var p=r.children(".sublayers");if(p.length>0)if(c===!1){var g=p.find(".layer-checkbox :checkbox");s===!1?g.prop("checked",!1).trigger("change",[s]):a.each(g,function(){var e=a(this);e.parent().data("shown")===!0&&e.prop("checked",!0).trigger("change",[s])})}else p.find(".layer-checkbox :checkbox").trigger("init",[s]);var u=M.indexOf(l);u!==-1&&s===!1?M.splice(u,1):(s===!0&&M.push(l),u===-1&&s===!0&&o.data("loaded")===n&&(o.data("loaded",!0),d(l,i))),c===!1&&0==p.length&&h()}),a(document).on("init change",".layer-checkbox :checkbox",function(e,n){var t=a(this),o=t.parents(".layer").children(".layer-toggle"),l=t.parent(),i=l.data("sublayer"),s=(o.data("type"),t.prop("checked")),n=n||o.find(":checkbox").prop("checked"),r="init"===e.type,c=M.indexOf(i);c!==-1&&s===!1?(M.splice(c,1),(r===!0||e.originalEvent)&&l.data("shown",!1)):s===!0&&(M.push(i),(r===!0||e.originalEvent)&&l.data("shown",!0)),r===!1&&h()}),a(document).on("change",".clustering-checkbox :checkbox",function(e){var n=a(this),t=[],o=[];C=n.prop("checked"),w.clearMarkers(),a.each(L,function(e,a){a.visible===!0||null!==a.map?t.push(a):o.push(a)}),u(o),g(t)}),a(document).on("change",".satellite-view :checkbox",function(e){e.preventDefault();var n=a(this).prop("checked");n?v.setMapTypeId("satellite"):v.setMapTypeId("terrain")}),a(document).on("click",".fullscreen-btn",function(e){e.preventDefault(),BigScreen.enabled&&BigScreen.toggle()}),BigScreen.onenter=function(){a(".fullscreen-btn").addClass("exit"),a(".panel-header").show()},BigScreen.onchange=function(){console.log("fullscreen change")},BigScreen.onexit=function(){a(".panel").addClass("collapsed"),a(".panel-header").hide(),a(".fullscreen-btn").removeClass("exit")}}(this,jQuery);